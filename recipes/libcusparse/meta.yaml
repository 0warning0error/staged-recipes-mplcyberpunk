{% set name = "libcusparse" %}
{% set version = "11.7.5.86" %}
{% set cuda_version = "12.0" %}
{% set platform = "linux-x86_64" %}    # [linux64]
{% set platform = "linux-ppc64le" %}   # [ppc64le]
{% set platform = "linux-sbsa" %}      # [aarch64]
{% set platform = "windows-x86_64" %}  # [win]

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://developer.download.nvidia.com/compute/cuda/redist/{{ name }}/{{ platform }}/{{ name }}-{{ platform }}-{{ version }}-archive.tar.xz
  sha256: 9250fe539d4bd6a378581dc0b528e8cfc418b57f28545bf39d70cae762075df7  # [linux64]
  sha256: 1072e26dc118cbf9d6f061eddbff45f2da2eef6c87c2b8a64fd1586af91a2735  # [ppc64le]
  sha256: 191ae1f26b15955b743f6c4978c8562b973b16671a9f684368d501919f906ce5  # [aarch64]
  sha256: b51a46f4f6bb9476ffe433a1dedad2c94a546c8a92e70dfed63207b64ff57e50  # [win]

build:
  number: 0
  skip: true  # [osx]
  missing_dso_whitelist:
    - /lib64/libpthread.so.0
    - /lib64/librt.so.1
    - /lib64/libdl.so.2
    - /lib64/libm.so.6
    - /lib64/libgcc_s.so.1
    - /lib64/libc.so.6
    - /lib64/ld-linux-x86-64.so.2

outputs:
  - name: libcusparse
    files:
      - lib/libcusparse.so.*
    requirements:
      host:
        - cuda-version {{ cuda_version }}
      run:
        - {{ pin_compatible("cuda-version", max_pin="x.x") }}
        - libnvjitlink
    test:
       commands:
         - test -f $PREFIX/lib/libcusparse.so  # [unix]
         - if not exist %LIBRARY_LIB%\\cusparse.lib exit 1  # [win]

  - name: libcusparse-dev
    requirements:
      host:
        - cuda-version {{ cuda_version }}
      run:
        - {{ pin_compatible("cuda-version", max_pin="x.x") }}
        - libcusparse >={{ version }}
    files:
      - lib/libcusparse.so*
      - lib/stubs/libcusparse.so*
      - include/cusparse*
      - src/cusparse_fortran*
    test:
      commands:
        - test -f $PREFIX/include/cusparse.h  # [linux]
        - if not exist %LIBRARY_INC%\\cusparse.h exit 1  # [win]

  - name: libcusparse-static
    requirements:
      host:
        - cuda-version {{ cuda_version }}
      run:
        - {{ pin_compatible("cuda-version", max_pin="x.x") }}
        - libcusparse-dev >={{ version }}
    files:
      - lib/libcusparse_static.a
    test:
      commands:
        - test -f $PREFIX/lib/libcusparse_static.a  # [linux]
        - if not exist %LIBRARY_LIB%\\cusparse_static.lib  # [win]

about:
  home: https://developer.nvidia.com/cuda-toolkit
  license_file: LICENSE
  license: LicenseRef-NVIDIA-End-User-License-Agreement
  license_url: https://docs.nvidia.com/cuda/eula/index.html
  summary: CUSPARSE native runtime libraries
  description: |
    CUSPARSE native runtime libraries
  doc_url: https://docs.nvidia.com/cuda/index.html

extra:
  recipe-maintainers:
    - adibbley
